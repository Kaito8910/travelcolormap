{% extends "base.html" %}
{% block title %}イベント検索結果 | 旅色マップ{% endblock %}

{% block main_content %}

<!-- 再検索フォーム -->
<div class="event-search-form">
    <form method="GET" action="{{ url_for('event.event_search_results') }}">

        <label>都道府県:</label>
        <select name="prefecture">
            <option value="">すべて</option>
            {% for p in prefectures %}
                <option value="{{ p }}"
                    {% if request.args.get("prefecture") == p %}selected{% endif %}>
                    {{ p }}
                </option>
            {% endfor %}
        </select>

        <label>開催月:</label>
        <select name="month">
            <option value="">すべて</option>
            {% for m in months %}
                <option value="{{ m }}"
                    {% if request.args.get("month") == m|string %}selected{% endif %}>
                    {{ m }}月
                </option>
            {% endfor %}
        </select>

        <label>開催時期:</label>
        <select name="period">
            <option value="">すべて</option>
            <option value="上旬" {% if request.args.get("period") == "上旬" %}selected{% endif %}>上旬</option>
            <option value="中旬" {% if request.args.get("period") == "中旬" %}selected{% endif %}>中旬</option>
            <option value="下旬" {% if request.args.get("period") == "下旬" %}selected{% endif %}>下旬</option>
        </select>

        <label>キーワード:</label>
        <input type="text" name="keyword"
               value="{{ request.args.get('keyword', '') }}">

        <button type="submit">再検索</button>
    </form>
</div>

<hr>

<!-- 検索結果 -->
<div class="event-results-container">

    {% if results|length == 0 %}

        {% if request.args %}
            <p class="no-results">
                条件に一致するイベントが見つかりませんでした。
            </p>
        {% else %}
            <p class="no-results">
                現在、イベントデータが登録されていません。
            </p>
        {% endif %}

    {% else %}

        <p class="result-count">
            {{ results|length }} 件のイベントが見つかりました
        </p>

        {% for ev in results %}
            <div class="event-card">

                <div class="event-title">
                    {{ ev.title }}
                </div>

                <div class="event-meta">
                    {{ ev.month }} /
                    {{ ev.pref_name }}
                    {% if ev.city %} / {{ ev.city }}{% endif %}
                    {% if ev.category %} / {{ ev.category }}{% endif %}

                    {% if session.get('logged_in') %}
                        <button class="bookmark-btn"
                            data-type="event"
                            data-id="{{ ev.id }}"
                            data-title="{{ ev.title }}"
                            data-url="{{ ev.url }}">
                            ☆ ブックマーク
                        </button>
                    {% endif %}
                </div>

                {% if ev.description %}
                    <div class="event-description">
                        {{ ev.description }}
                    </div>
                {% endif %}

            </div>
        {% endfor %}

    {% endif %}

</div>

{% endblock %}
